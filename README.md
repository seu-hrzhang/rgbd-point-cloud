# Point Cloud Generator from RGBD Images

## Introduction

This project is an implementation of point cloud generator using RGBD images. The target object is first detected and localized in the RGB input image using Mask R-CNN, which produces the mask image for the object (instance segmentation). The mask area is then extracted from the depth image and transformed to the world coordinate using known camera parameters. The final point cloud is obtained after removal of outliers.

## Dependencies

This program was built and tested on Ubuntu 18.04 (running on Windows not recommended). The following dependencies are required:

* [Mask R-CNN](https://github.com/facebookresearch/maskrcnn-benchmark)
* [OpenCV](https://opencv.org) (ver. 4.5.2 or later)
* [PCL](https://pointclouds.org) (ver. 1.12.0 or later)
* other dependencies required by the above

Please make sure they are properly installed before running this program.

## Usage

### Configurations

The `/config` folder in the root directory stores configuration files of the program.

Paths of image dataset and output files are configured in `path.json`. A demo of `path.json` is as follows:

```json
{
    "rgb_dir": "../../maskrcnn-benchmark/datasets/rgb/",
    "depth_dir": "../../maskrcnn-benchmark/datasets/depth/",
    "mask_dir": "../mask/",
    "mask_file": "./masks.txt",
    "output_dir": "../output/"
}
```

`masks.txt` is automatically generated by `run.py`, therefore needless to be modified manually.

Your project directory should be similar to

```
+── root
│   +── maskrcnn-benchmark
|   |   +── datasets
|   |   |   +── rgb
|   |   |   +── depth
|   |   |   +── ...
|   |   +── demo
|   |   |   +── run.py
|   |   |   +── ...
|   |   ...
│   +── rgbd-point-cloud
|   │   +── config
|   |   |   +── masks.txt
|   |   |   +── path.json
|   │   +── mask
|   │   +── output
```

### Running Program

1. Train and evaluate Mask R-CNN network using your custom dataset.
2. Copy (or move) and run `run.py` in the `/demo` directory of `/maskrcnn-benchmark`.
3. Build and run the project.

The output file is in `.json` format, including 3D coordinates of the target object. Multiple items will be listed in the output file if more than one targets exist in the source image.